"use strict";const U=require("@codemirror/state"),t=require("@lezer/highlight"),m=require("markedit-api"),q=require("@codemirror/view"),p=require("@codemirror/language"),y=(a,c={})=>a??c,J=y(m.MarkEdit.userSettings),M=y(J["extension.markeditTheming"]),Q=M.enabledMode??"both",I=y(M.lightTheme),O=y(M.darkTheme),G=a=>["both",a?"dark":"light"].includes(Q),X=H(I),Y=H(O,{dark:!0});function Z(a,c){if(!G(a))return c;const e=a?Y:X;return e===void 0?c:[e,c].filter(r=>r!==void 0)}function tt(a,c){if(!G(a))return c;const e=a?O.custom:I.custom;return e===void 0?c:{...c,...e}}function H(a,c){const e={},r=[],n=a.editor,o=a.highlight;return n?.textColor&&(e["&"]??={},e["&"].color=n?.textColor,e[".cm-activeLineGutter"]={backgroundColor:n?.textColor}),n?.backgroundColor&&(e["&"]??={},e["&"].backgroundColor=n?.backgroundColor),n?.activeLineBackground&&(e[".cm-activeLine"]={backgroundColor:n?.activeLineBackground}),n?.caretColor&&(e[".cm-content"]={caretColor:n?.caretColor},e[".cm-cursor, .cm-dropCursor"]={borderLeftColor:n?.caretColor}),n?.selectionBackground&&(e["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:n?.selectionBackground}),n?.matchingBracketBackground&&(e["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:n?.matchingBracketBackground}),n?.gutterText&&(e[".cm-gutters"]??={},e[".cm-gutters"].color=n?.gutterText),n?.gutterBackground&&(e[".cm-gutters"]??={},e[".cm-gutters"].backgroundColor=n?.gutterBackground,e[".cm-gutters"].border="none"),n?.foldPlaceholderText&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].color=n?.foldPlaceholderText),n?.foldPlaceholderBackground&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].backgroundColor=n?.foldPlaceholderBackground,e[".cm-foldPlaceholder"].border="none"),n?.searchMatchBackground&&(e[".cm-searchMatch"]={backgroundColor:n?.searchMatchBackground}),n?.selectionMatchBackground&&(e[".cm-selectionMatch"]={backgroundColor:n?.selectionMatchBackground}),o?.heading&&r.push({tag:t.tags.heading,color:o?.heading}),o?.bold&&r.push({tag:t.tags.strong,color:o?.bold}),o?.italic&&r.push({tag:t.tags.emphasis,color:o?.italic}),o?.strikethrough&&r.push({tag:t.tags.strikethrough,color:o?.strikethrough}),o?.quote&&r.push({tag:t.tags.quote,color:o?.quote}),o?.link&&r.push({tag:[t.tags.url,t.tags.link],color:o?.link}),o?.separator&&r.push({tag:[t.tags.definition(t.tags.name),t.tags.separator,t.tags.contentSeparator],color:o?.separator}),o?.comment&&r.push({tag:t.tags.comment,color:o?.comment}),o?.meta&&r.push({tag:t.tags.meta,color:o?.meta}),o?.keyword&&r.push({tag:t.tags.keyword,color:o?.keyword}),o?.atom&&r.push({tag:[t.tags.atom,t.tags.bool],color:o?.atom}),o?.literal&&r.push({tag:[t.tags.literal,t.tags.inserted],color:o?.literal}),o?.string&&r.push({tag:[t.tags.string,t.tags.deleted],color:o?.string}),o?.special&&r.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:o?.special}),o?.variable&&r.push({tag:t.tags.definition(t.tags.variableName),color:o?.variable}),o?.local&&r.push({tag:t.tags.local(t.tags.variableName),color:o?.local}),o?.type&&r.push({tag:[t.tags.typeName,t.tags.namespace],color:o?.type}),o?.class&&r.push({tag:t.tags.className,color:o?.class}),o?.macro&&r.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:o?.macro}),o?.property&&r.push({tag:t.tags.definition(t.tags.propertyName),color:o?.property}),o?.label&&r.push({tag:t.tags.labelName,color:o?.label}),o?.operator&&r.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:o?.operator}),o?.constant&&r.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:o?.constant}),o?.instruction&&r.push({tag:t.tags.processingInstruction,color:o?.instruction}),o?.invalid&&r.push({tag:t.tags.invalid,color:o?.invalid}),[q.EditorView.theme(e,c),p.syntaxHighlighting(p.HighlightStyle.define(r))]}const s={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",emphasisElement:".cm-md-bold:not(.tok-meta), .cm-md-italic:not(.tok-meta), .cm-md-quote:not(.cm-md-quoteMark)",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark"},et=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${s.lineGutter} {}
${s.foldGutter} {}
${s.visibleSpace} {}
${s.matchingBracket} {}
${s.activeIndicator} {}
${s.emphasisElement} {}
${s.accentColor} {}
${s.syntaxMarker} {}
`,j=window,ot=j.__extractStyleRules__??(a=>a.value?.rules),at=j.__extractHighlightSpecs__??(a=>a.value?.specs);function rt(a){const c=document.createElement("style");return c.textContent=a,document.head.appendChild(c),c}function ct(a){if(a===void 0)return[{},[]];const c=S(a);return[Object.fromEntries(c.flatMap(r=>{const n=ot(r)?.join(`
`)??"";return Object.entries(st(n))})),c.flatMap(r=>at(r)??[])]}function L(a,c){return a.find(e=>!!(e.tag.toString().includes(c.toString())&&e.color!==void 0))?.color}function B(a,c,e){for(const[r,n]of Object.entries(a))if(r.includes(c)&&(e===void 0||!r.includes(e))){const o=n.background??n.backgroundColor;if(o!==void 0)return o}}function nt(a){const c=a.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(c===null)return;const[e,r,n]=c.slice(1,4).map(Number);return`rgba(${e}, ${r}, ${n}, 0.6)`}function S(a){return Array.isArray(a)?a.flatMap(S):"extension"in a?S(a.extension):[a]}function st(a){const c={},e=new CSSStyleSheet;e.replaceSync(a);for(const r of e.cssRules){const{style:n,selectorText:o}=r,{background:l,backgroundColor:d}=n;c[o]={},l.length>0&&(c[o].background=l),d.length>0&&(c[o].backgroundColor=d)}return c}function it(a){a.light!==void 0&&(i().customThemes.light=a.light),a.dark!==void 0&&(i().customThemes.dark=a.dark),typeof m.MarkEdit.editorView=="object"&&T(m.MarkEdit.editorView)}const k=window,i=()=>k.__markeditTheming__,R=matchMedia("(prefers-color-scheme: dark)");typeof i()!="object"&&gt();function gt(){k.__markeditTheming__={styleSheet:rt(et),configurator:new U.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},m.MarkEdit.addExtension(i().configurator.of([])),m.MarkEdit.onEditorReady(c=>T(c));const a=()=>setTimeout(()=>T(m.MarkEdit.editorView),15);R.addEventListener("change",a),i().mainThemeName=k.config.theme,Object.defineProperty(k.config,"theme",{get(){return i().mainThemeName},set(c){i().mainThemeName=c,a()}})}function T(a){const c=R.matches,e=c?i().customThemes.dark:i().customThemes.light,r=Z(c,e?.extension),n=tt(c,e?.colors);a.dispatch({effects:i().configurator.reconfigure(r??[])});const[o,l]=ct(r),d=r===void 0;i().styleSheet.disabled=d,lt(a,c,d,o,l,n)}function lt(a,c,e,r,n,o){const l=B(r,".cm-activeLine",".cm-activeLineGutter"),d=B(r,s.selectionBackground),v=B(r,s.matchingBracket),h=getComputedStyle(a.contentDOM).color,N=o?.visibleSpace??nt(h),w=L(n,t.tags.heading),D=L(n,t.tags.processingInstruction),A=[[s.activeIndicator,l,"background"],[s.matchingBracket,v,"background"],[s.lineGutter,h,"color"],[s.foldGutter,N,"color"],[s.visibleSpace,N,"color"],[s.accentColor,o?.accentColor??w,"color"],[s.syntaxMarker,o?.syntaxMarker??D,"color"]],V=Array.from(document.querySelectorAll("style")),f=c?i().darkOriginalRules:i().lightOriginalRules;for(const z of V){const C=z.sheet?.cssRules;if(C!==void 0)for(let x=0;x<C.length;++x){const g=C[x],u=g.selectorText??"";u.includes(".cm-focused")&&u.includes(s.selectionBackground)&&(f.selectionBackground??=g.cssText,e?g.cssText=f.selectionBackground:d!==void 0&&g.style.setProperty("background",d,"important")),w!==void 0&&(u===".cm-md-header"||u===".cm-md-header:not(.cm-md-quote)")&&(f.markdownHeader??=g.cssText,e?g.cssText=f.markdownHeader:g.style.removeProperty("color"));for(const[W,$,E]of A)if(u===W)if($===void 0)g.style.removeProperty(E);else{const K=[s.accentColor,s.syntaxMarker].includes(u)?void 0:"important";g.style.setProperty(E,$,K),(u===s.matchingBracket||u===s.activeIndicator)&&g.style.setProperty("box-shadow","unset","important")}u===s.emphasisElement&&(o?.subtleEmphasis??!0?g.style.setProperty("color","inherit","important"):g.style.removeProperty("color"))}}}function b(){return b=Object.assign?Object.assign.bind():function(a){for(var c=1;c<arguments.length;c++){var e=arguments[c];for(var r in e)({}).hasOwnProperty.call(e,r)&&(a[r]=e[r])}return a},b.apply(null,arguments)}var F=a=>{var{theme:c,settings:e={},styles:r=[]}=a,n={".cm-gutters":{}},o={};e.background&&(o.backgroundColor=e.background),e.backgroundImage&&(o.backgroundImage=e.backgroundImage),e.foreground&&(o.color=e.foreground),e.fontSize&&(o.fontSize=e.fontSize),(e.background||e.foreground)&&(n["&"]=o),e.fontFamily&&(n["&.cm-editor .cm-scroller"]={fontFamily:e.fontFamily}),e.gutterBackground&&(n[".cm-gutters"].backgroundColor=e.gutterBackground),e.gutterForeground&&(n[".cm-gutters"].color=e.gutterForeground),e.gutterBorder&&(n[".cm-gutters"].borderRightColor=e.gutterBorder),e.caret&&(n[".cm-content"]={caretColor:e.caret},n[".cm-cursor, .cm-dropCursor"]={borderLeftColor:e.caret});var l={};e.gutterActiveForeground&&(l.color=e.gutterActiveForeground),e.lineHighlight&&(n[".cm-activeLine"]={backgroundColor:e.lineHighlight},l.backgroundColor=e.lineHighlight),n[".cm-activeLineGutter"]=l,e.selection&&(n["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:e.selection+" !important"}),e.selectionMatch&&(n["& .cm-selectionMatch"]={backgroundColor:e.selectionMatch});var d=q.EditorView.theme(n,{dark:c==="dark"}),v=p.HighlightStyle.define(r),h=[d,p.syntaxHighlighting(v)];return h},dt={background:"#1a1b26",foreground:"#787c99",caret:"#c0caf5",selection:"#515c7e40",selectionMatch:"#16161e",gutterBackground:"#1a1b26",gutterForeground:"#787c99",gutterBorder:"transparent",lineHighlight:"#474b6611"},ut=[{tag:t.tags.keyword,color:"#bb9af7"},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.macroName],color:"#c0caf5"},{tag:[t.tags.propertyName],color:"#7aa2f7"},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted,t.tags.special(t.tags.string)],color:"#9ece6a"},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:"#7aa2f7"},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:"#bb9af7"},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:"#c0caf5"},{tag:[t.tags.className],color:"#c0caf5"},{tag:[t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:"#ff9e64"},{tag:[t.tags.typeName],color:"#0db9d7"},{tag:[t.tags.operator,t.tags.operatorKeyword],color:"#bb9af7"},{tag:[t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link],color:"#b4f9f8"},{tag:[t.tags.meta,t.tags.comment],color:"#444b6a"},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.link,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:"#89ddff"},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:"#c0caf5"},{tag:t.tags.invalid,color:"#ff5370"},{tag:t.tags.strikethrough,textDecoration:"line-through"}],mt=a=>{var{theme:c="dark",settings:e={},styles:r=[]}={};return F({theme:c,settings:b({},dt,e),styles:[...ut,...r]})},ht=mt(),ft={background:"#e1e2e7",foreground:"#3760bf",caret:"#3760bf",selection:"#99a7df",selectionMatch:"#99a7df",gutterBackground:"#e1e2e7",gutterForeground:"#3760bf",gutterBorder:"transparent",lineHighlight:"#5f5faf11"},kt=[{tag:t.tags.keyword,color:"#007197"},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.macroName],color:"#3760bf"},{tag:[t.tags.propertyName],color:"#3760bf"},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted,t.tags.special(t.tags.string)],color:"#587539"},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:"#3760bf"},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:"#3760bf"},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:"#3760bf"},{tag:[t.tags.className],color:"#3760bf"},{tag:[t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:"#b15c00"},{tag:[t.tags.typeName],color:"#007197",fontStyle:"#007197"},{tag:[t.tags.operator,t.tags.operatorKeyword],color:"#007197"},{tag:[t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link],color:"#587539"},{tag:[t.tags.meta,t.tags.comment],color:"#848cb5"},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.link,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:"#b15c00"},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:"#3760bf"},{tag:t.tags.invalid,color:"#f52a65"},{tag:t.tags.strikethrough,textDecoration:"line-through"}],pt=a=>{var{theme:c="light",settings:e={},styles:r=[]}={};return F({theme:c,settings:b({},ft,e),styles:[...kt,...r]})},bt=pt();const P=(a,c={})=>a??c,yt=P(P(m.MarkEdit.userSettings)["extension.markeditThemeTokyoNight"]),_=yt.enabledMode??"both",vt={extension:bt},Ct={extension:ht};it({light:["both","light"].includes(_)?vt:void 0,dark:["both","dark"].includes(_)?Ct:void 0});
